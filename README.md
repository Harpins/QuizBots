# Викторина «Что? Где? Когда?» — боты для Telegram и VK
Два синхронизированных бота для проведения викторины в стиле «Что? Где? Когда?»:

- [**Telegram-бот** ](https://t.me/harpinsquizbot)
- [**VK-бот** (групповой / сообщество)](https://vk.me/club235557361)

Оба бота используют **одну общую базу вопросов**, хранящуюся в **Redis**, и одинаковую игровую логику.

## Возможности

- Случайный выбор вопроса из базы
- Показ вопроса → ожидание ответа участника
- Проверка правильности ответа (с учётом регистронезависимости и лишних пробелов)
- Система использованных вопросов по пользователю (чтобы не повторялись)
- Миграция вопросов из JSON / текстовых файлов в Redis
- Поддержка очистки Redis от игровых данных

## Структура проекта

QuizBots/
├── tg_bot              # Telegram-бот (aiogram)
│   └── handlers        # обработчики сообщений, колбэков и т.д.  
├── vk_bot              # VK-бот (vk_api)
├── utils               # общие вспомогательные модули
├── settings.py         # конфигурация (токены, redis)
├── requirements.txt    # зависимости
├── .gitignore
└── README.md


## Требования

- Python 3.10+
- Redis (локально или удалённо)
- Токены ботов Telegram и VK

## Установка и запуск

1. Клонируйте репозиторий

```bash
git clone https://github.com/Harpins/QuizBots.git
cd QuizBots
```

2. Установите зависимости

```bash
pip install -r requirements.txt
```
3. Создайте файл `.env`, содержащий переменные окружения

Основные переменные окружения:

# Telegram
`TG_BOT_TOKEN` Токен бота TG, можно получить у `@BotFather`

# VK
`VK_GROUP_TOKEN` Токен API VK, можно получить [в настройках сообщества](https://dev.vk.com/ru/api/access-token/community-token/in-community-settings)

# TG Бот-сборщик ошибок
`ERROR_BOT_TOKEN` Токен бота-сборщика, можно получить у `@BotFather`
`ERROR_CHAT_ID` ID чата с ботом, можно узнать по API `https://api.telegram.org/bot{ERROR_BOT_TOKEN}/getUpdates`

# Настройки Redis
`REDIS_HOST` По умолчанию - "localhost"
`REDIS_PORT` По умолчанию - 6379
`REDIS_DB` По умолчанию - 0
`REDIS_DECODE_RESPONSES` По умолчанию - True

4. Загрузите вопросы в Redis (хэш quiz:questions)

4.1 Миграцией из JSON-файла:

```bash
python -m utils.helpers migrate --file your_questions.json
```
флаг `--file` необязательный, по дефолту проводит миграцию из файла с названием `quiz.json`

JSON-файл должен состоять из пар вопрос-ответ, например:
```json
{
  "Столица Франции?": "Париж",
  "Самая большая планета?": "Юпитер"
}
```
Для очистки БД Redis от **ВСЕХ** данных викторины (по ключам quiz:*) можно воспользоваться скриптом:
```bash
python -m utils.helpers clear
```
Перед очисткой БД скрипт потребует подтверждение.
Для запуска скрипта без подтверждения доступен флаг `--confirm`


4.2 Конвертация txt-файлов в JSON с и последующая миграция
Скрипт `utils/parse_to_json.py` способен парсить пары вопрос-ответ из текстовых файлов с вопросами ЧГК (в KOI8-R) ([Пример архива с текстовыми файлами](https://dvmn.org/media/modules_dist/quiz-questions.zip)).
Текстовые файлы должны находиться в одной директории в корне проекта (по дефолту - в `txt_files`). 
Пары вопрос-ответ будут загружены в единый JSON файл (по дефолту - `quiz.json`, пример структуры приведен в п. 4.1)
После успешного формирования JSON необходимо запустить миграцию в Redis по 4.1


5. Запуск ботов

# Telegram-бот
```bash
python -m tg_bot.main
```

# VK-бот
```bash
python -m vk_bot.main
```



